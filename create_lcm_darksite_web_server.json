{"status":{},"spec":{"name":"create_lcm_darksite_web_server","description":"Deploy dark site web server & reconfigure LCM for local web server updates\n\nReference: https:\/\/github.com\/arthurpk1209\/nutanix-lcm","resources":{"service_definition_list":[{"name":"BasicLinux","description":"","variable_list":[],"action_list":[{"type":"system","name":"action_create","description":"System action for creating an application","runbook":{"name":"Runbook_for_Service_BasicLinux_action_create","description":"","task_definition_list":[{"type":"DAG","name":"DAG_Task_for_Service_BasicLinux_action_create","description":"","attrs":{"type":"","edges":[{"type":"","from_task_reference":{"name":"Configure Base VM","kind":"app_task"},"to_task_reference":{"name":"Configure Storage","kind":"app_task"},"edge_type":"user_defined"}]},"child_tasks_local_reference_list":[{"name":"Configure Base VM","kind":"app_task"},{"name":"Configure Storage","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"BasicLinux","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"EXEC","name":"Configure Base VM","description":"","attrs":{"type":"","script":"#!\/bin\/sh\n\n# update centos packages\nsudo dnf -y update\n\n# install some useful packages\nsudo dnf -y install git bash-completion vim net-tools bind-utils wget firewalld unzip\n\n# set the hostname\nsudo hostnamectl set-hostname @@{HOSTNAME}@@\nsudo timedatectl set-timezone Asia\/Taipei","script_type":"sh","command_line_args":"","exit_status":[],"login_credential_local_reference":{"name":"admin","kind":"app_credential"}},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"BasicLinux","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"EXEC","name":"Configure Storage","description":"","attrs":{"type":"","script":"#!\/bin\/sh\n\n# create single partition on sdb\n(\necho o # Create a new empty DOS partition table\necho n # Add a new partition\necho p # Primary partition\necho 1 # Partition number\necho   # First sector (Accept default: 1)\necho   # Last sector (Accept default: varies)\necho w # Write changes\n) | sudo fdisk \/dev\/sdb\nsudo mkfs.ext4 \/dev\/sdb1\nsudo mkdir -p \/mnt\/lcm\nsudo mount -t ext4 \/dev\/sdb1 \/mnt\/lcm","script_type":"sh","command_line_args":"","exit_status":[],"login_credential_local_reference":{"name":"admin","kind":"app_credential"}},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"BasicLinux","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"DAG_Task_for_Service_BasicLinux_action_create","kind":"app_task"},"variable_list":[]},"critical":true},{"type":"system","name":"action_delete","description":"System action for deleting an application. Deletes created VMs as well","runbook":{"name":"Runbook_for_Service_BasicLinux_action_delete","description":"","task_definition_list":[{"type":"DAG","name":"DAG_Task_for_Service_BasicLinux_action_delete","description":"","attrs":{"type":"","edges":[{"type":"","from_task_reference":{"name":"Get LCM eTag","kind":"app_task"},"to_task_reference":{"name":"Revert LCM to Nutanix Portal","kind":"app_task"},"edge_type":"user_defined"}]},"child_tasks_local_reference_list":[{"name":"Get LCM eTag","kind":"app_task"},{"name":"Revert LCM to Nutanix Portal","kind":"app_task"}],"variable_list":[],"target_any_local_reference":{"name":"BasicLinux","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"HTTP","name":"Get LCM eTag","description":"","attrs":{"type":"","method":"GET","connection_timeout":120,"headers":[],"url":"https:\/\/localhost:9440\/api\/lcm\/v4.0.a1\/resources\/config","request_body":"","content_type":"application\/json","expected_response_params":[{"type":"","code":200,"status":"SUCCESS"}],"authentication":{"type":"basic_with_cred","credential_local_reference":{"name":"Prism Central Admin","kind":"app_credential"}},"response_paths":{"current_etag":"$.metadata.ETag"},"tls_verify":false,"proxy_type":"","retry_count":1,"retry_interval":1},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"BasicLinux","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"HTTP","name":"Revert LCM to Nutanix Portal","description":"","attrs":{"type":"","method":"PUT","connection_timeout":120,"headers":[{"type":"LOCAL","name":"If-Match","description":"","regex":{"value":"","should_validate":true},"options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"state":"NOT_VALIDATED","message_list":[],"editables":{},"value":"@@{current_etag}@@"}],"url":"https:\/\/localhost:9440\/api\/lcm\/v4.0.a1\/resources\/config","request_body":"{\n  \"isDarksite\": false,\n  \"enableHttps\": true\n}","content_type":"application\/json","expected_response_params":[{"type":"","code":200,"status":"SUCCESS"}],"authentication":{"type":"basic_with_cred","credential_local_reference":{"name":"Prism Central Admin","kind":"app_credential"}},"response_paths":{},"tls_verify":false,"proxy_type":"","retry_count":1,"retry_interval":1},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"BasicLinux","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"DAG_Task_for_Service_BasicLinux_action_delete","kind":"app_task"},"variable_list":[]},"critical":true},{"type":"system","name":"action_start","description":"System action for starting an application","runbook":{"name":"Runbook_for_Service_BasicLinux_action_start","description":"","task_definition_list":[{"type":"DAG","name":"DAG_Task_for_Service_BasicLinux_action_start","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"BasicLinux","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"DAG_Task_for_Service_BasicLinux_action_start","kind":"app_task"},"variable_list":[]},"critical":true},{"type":"system","name":"action_stop","description":"System action for stopping an application","runbook":{"name":"Runbook_for_Service_BasicLinux_action_stop","description":"","task_definition_list":[{"type":"DAG","name":"DAG_Task_for_Service_BasicLinux_action_stop","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"BasicLinux","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"DAG_Task_for_Service_BasicLinux_action_stop","kind":"app_task"},"variable_list":[]},"critical":true},{"type":"system","name":"action_restart","description":"System action for restarting an application","runbook":{"name":"Runbook_for_Service_BasicLinux_action_restart","description":"","task_definition_list":[{"type":"DAG","name":"DAG_Task_for_Service_BasicLinux_action_restart","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"BasicLinux","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"DAG_Task_for_Service_BasicLinux_action_restart","kind":"app_task"},"variable_list":[]},"critical":true},{"type":"system","name":"action_soft_delete","description":"System action for deleting an application. Does not delete created VMs","runbook":{"name":"Runbook_for_Service_BasicLinux_action_soft_delete","description":"","task_definition_list":[{"type":"DAG","name":"DAG_Task_for_Service_BasicLinux_action_soft_delete","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"BasicLinux","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"DAG_Task_for_Service_BasicLinux_action_soft_delete","kind":"app_task"},"variable_list":[]},"critical":true}],"depends_on_list":[],"port_list":[],"singleton":false,"tier":""}],"published_service_definition_list":[],"substrate_definition_list":[{"type":"AHV_VM","name":"BasicLinuxVm","description":"","variable_list":[],"action_list":[{"type":"fragment","name":"pre_action_create","description":"","runbook":{"name":"0b0c2f05_runbook","description":"","task_definition_list":[{"type":"DAG","name":"d0ea3d51_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"BasicLinuxVm","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"d0ea3d51_dag","kind":"app_task"},"variable_list":[]},"critical":false},{"type":"fragment","name":"post_action_delete","description":"","runbook":{"name":"73f62882_runbook","description":"","task_definition_list":[{"type":"DAG","name":"cb3a0f31_dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"BasicLinuxVm","kind":"app_substrate"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"cb3a0f31_dag","kind":"app_task"},"variable_list":[]},"critical":false}],"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{}}}},"create_spec":{"type":"","name":"lcm-web-server-@@{calm_today}@@","availability_zone_reference":null,"backup_policy":null,"cluster_reference":{"type":"","kind":"cluster","name":"NX1365G6PE","uuid":"00061972-aeba-fee2-0000-000000028e95"},"resources":{"type":"","nic_list":[{"type":"","nic_type":"NORMAL_NIC","subnet_reference":{"type":"","kind":"subnet","name":"Primary","uuid":"060837bb-aefc-41f2-aaae-25c95267d87a"},"network_function_nic_type":"INGRESS","mac_address":"","ip_endpoint_list":[],"network_function_chain_reference":null,"vpc_reference":null}],"power_state":"ON","guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"memory_size_mib":8192,"gpu_list":[],"parent_reference":null,"hardware_clock_timezone":"","account_uuid":"999c3937-9b21-431d-af2a-9216571986c5","guest_customization":{"type":"","cloud_init":{"type":"","meta_data":"","user_data":"#cloud-config\nusers:\n  - default\n  - name: @@{admin.username}@@\n    gecos: admin user\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\n    groups: users,wheel\n    shell: \/bin\/bash\n    lock_passwd: false\n    ssh-authorized-keys:\n      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC+5McokuaO2C4TQpjvadJO5FZZn6LvDovPx5VJKzpCgaF0YWa\/JKLcSFIkAXv8HSP+EBL0JVSJtay7DI2GqBW6s2o7EdhbVUGC\/Ujxsu4nzvbbnqMok4q3rpCVx8RwRkwRJHZCBaYBiKIGSWrO19G6bnpPN6vqbtNyk9aG0Qe0P9Mnqb3aqNAZXltz6Q98xkBaczIeQ0qKKSbhr5E8AGXpobxO+yCfDlgeGzACOyipbJ6SWu4q2fXFNkRuqq7SC7B9MYbao8HEGlVxBFQKWixI68CG+8m2NSF6D4gQ1Sdj6OB+\/zqUK1lXAzApQAgqlHwGju\/7UEA6xQdW8esxOFL+r18+AXnCOAwF1jcl7furnSvdMFox6nFHJdWPGkEiWUdycWJ2IFTeaqKn1DVSPiV3y2jaAgyfIWyMtwHwEEUBZo8XrWp\/25qqFEALSzuiyL24LhNYVGyHcI5bZWcPFvd3RsEjcjlzYeVX1\/8IW9mFNkEnj9gR6vPIsrVMqHRbsHOXgK1xKkCnpQZ2c4kJqO4hj2D6IToZMZAnxF0bHBRsocN1MPxxb55C4zisfswC7hALdK0AU2gyrhS4GwsQQFEf4mV+Fz8BfhsBQY8X4\/rM1sBRjed28xBlJCCwicVkQQMYOnquDEHCdZYOoa692fCfLsFCfnPy73tzgrGMUiWD1w== nutanix@nutanixlab.local\n    passwd: $6$rounds=4096$sMhoL024aGfB.wzU$DarURzeu8\/muRjaItlqAIVLSfaxV2u0pCdkSwBPAB0fu6R7Oi9LzdZMTA\/TvV23c.BiCQYrFVavGyyk\/vkZuZ1\nchpasswd:\n  list: |\n    root:nutanix\/4u\n  expire: False\nssh_pwauth: True\npackage_update: true\npackages:\n- crypto-policies\nruncmd:\n  - update-crypto-policies --set DEFAULT:SHA1\n  - sed -i -e '\/^PermitRootLogin\/s\/^.*$\/PermitRootLogin no\/' \/etc\/ssh\/sshd_config\n  - sed -i -e '$aAllowUsers admin' \/etc\/ssh\/sshd_config\n  - systemctl restart --no-block sshd.service"},"sysprep":null},"boot_config":{"type":"","boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"mac_address":"","boot_type":"LEGACY"},"disk_list":[{"type":"","data_source_reference":{"type":"","kind":"app_package","name":"RockyLinuxImage_94","uuid":"a307dc72-bd4e-4dd8-7fd1-44557d147515"},"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"},"disk_size_mib":15360},{"type":"","data_source_reference":null,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":1,"adapter_type":"SCSI"},"device_type":"DISK"},"disk_size_mib":122880}],"serial_port_list":[]},"categories":{}},"os_type":"Linux","readiness_probe":{"login_credential_local_reference":{"name":"admin","kind":"app_credential"},"connection_type":"SSH","connection_port":22,"delay_secs":"120","retries":"5","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","disable_readiness_probe":false,"connection_protocol":""}}],"package_definition_list":[{"type":"CUSTOM","name":"BasicLinuxPackage","description":"","variable_list":[],"action_list":[],"service_local_reference_list":[{"name":"BasicLinux","kind":"app_service"}],"version":"","options":{"type":"","install_runbook":{"name":"BasicLinuxPackage___install___runbook","description":"","task_definition_list":[{"type":"DAG","name":"BasicLinuxPackage___install___dag","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"BasicLinux","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"BasicLinuxPackage___install___dag","kind":"app_task"},"variable_list":[]},"uninstall_runbook":{"name":"Runbook_for_Package_BasicLinuxPackage_action_uninstall","description":"","task_definition_list":[{"type":"DAG","name":"DAG_Task_for_Package_BasicLinuxPackage_action_uninstall","description":"","attrs":{"type":"","edges":[]},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"BasicLinux","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"DAG_Task_for_Package_BasicLinuxPackage_action_uninstall","kind":"app_task"},"variable_list":[]},"upgrade_runbook":{}}},{"type":"SUBSTRATE_IMAGE","name":"RockyLinuxImage_94","description":"","variable_list":[],"action_list":[],"service_local_reference_list":[],"version":"","options":{"type":"","name":"9.4-20240523.0","resources":{"type":"","image_type":"DISK_IMAGE","checksum":{},"source_uri":"http:\/\/d.rockylinux.org\/pub\/rocky\/9\/images\/x86_64\/Rocky-9-GenericCloud-Base-9.4-20240523.0.x86_64.qcow2","version":{"type":"","product_version":"9.4","product_name":"RockyLinux"},"architecture":"X86_64"},"description":""}}],"app_profile_list":[{"name":"Default","description":"","variable_list":[{"type":"LOCAL","name":"STATIC_EXPIRATION_DAYS","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":true},"value":"365"},{"type":"LOCAL","name":"HOSTNAME","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":true},"value":"lcm-web-server"},{"type":"LOCAL","name":"MSP","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"value":"http:\/\/download.nutanix.com\/MSP\/2.4.6.0\/lcm_msp_2.4.6.0.tar.gz"},{"type":"LOCAL","name":"SELF_SERVICE_NUCALM","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"value":"http:\/\/download.nutanix.com\/Calm\/3.8.0\/NuCalm-3.8.0.zip"},{"type":"LOCAL","name":"SELF_SERVICE_EPSILON","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"value":"http:\/\/download.nutanix.com\/Calm\/3.8.0\/Epsilon-3.8.0.zip"},{"type":"LOCAL","name":"NCC","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"value":"http:\/\/download.nutanix.com\/ncc\/v5.0.1\/lcm_ncc_5.0.1.tar.gz"},{"type":"LOCAL","name":"CMU","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"value":"http:\/\/download.nutanix.com\/cmu\/lcm-builds\/darksite\/2.0.3\/lcm_cmu_2.0.3.tar.gz"},{"type":"LOCAL","name":"PC","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"value":"http:\/\/download.nutanix.com\/pc\/pc.2024.1.0.2\/lcm_pc_pc.2024.1.0.2.tar.gz"},{"type":"LOCAL","name":"AHV","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"value":"http:\/\/download.nutanix.com\/hypervisor\/ahv\/lcm-builds\/darksite\/el8.nutanix.20230302.101026\/lcm_ahv_el8.nutanix.20230302.101026.tar.gz"},{"type":"LOCAL","name":"AOS","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"value":"http:\/\/download.nutanix.com\/releases\/6.8.1\/lcm_nos_6.8.1.tar.gz"},{"type":"LOCAL","name":"NKE","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"value":"http:\/\/download.nutanix.com\/karbon\/2.10.1\/lcm_karbon_2.10.1.tar.gz"},{"type":"LOCAL","name":"NETWORK_GATEWAY","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"value":"http:\/\/download.nutanix.com\/networkGateway\/6.4.170fcf6.20240318\/vyos_6.4.170fcf6.20240318.zip"},{"type":"LOCAL","name":"FLOW_VIRTUAL_NETWORKING","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"value":"http:\/\/download.nutanix.com\/AdvancedNetworking\/lcm-builds\/darksite\/4.0.0.tar.gz"},{"type":"LOCAL","name":"FLOW_PE","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"value":"http:\/\/download.nutanix.com\/FlowCVM\/5.0.0\/lcm_flow_cvm_5.0.0.tar.gz"},{"type":"LOCAL","name":"FLOW_PC","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"value":"http:\/\/download.nutanix.com\/FlowPC\/5.0.0\/lcm_flow_pc_5.0.0.tar.gz"},{"type":"LOCAL","name":"OBJECTS","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"value":"http:\/\/download.nutanix.com\/NutanixObjects\/5.0\/objects-5.0.tar.gz"},{"type":"LOCAL","name":"FILES_ANALYTICS","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"value":"http:\/\/download.nutanix.com\/fileanalytics\/3.4.0.1\/lcm_file_analytics_3.4.0.1.tar.gz"},{"type":"LOCAL","name":"FILES_MANAGER","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"value":"http:\/\/download.nutanix.com\/fm\/5.0.0.2\/lcm_files_manager_5.0.0.2.tar.gz"},{"type":"LOCAL","name":"FSM","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"value":"http:\/\/download.nutanix.com\/fsm\/5.0.0.2\/lcm_fsm_5.0.0.2.tar.gz"},{"type":"LOCAL","name":"FILE_SERVER","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"value":"http:\/\/download.nutanix.com\/afs\/5.0.0.2\/lcm_file_server_5.0.0.2.tar.gz"},{"type":"LOCAL","name":"FIRMWARE","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":true},"value":"http:\/\/download.nutanix.com\/Platforms\/lcm-builds\/nx\/dark-site\/3.8.0\/lcm_nx_3.8.0.tar.gz"},{"type":"LOCAL","name":"FOUNDATION_CENTRAL","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"value":"http:\/\/download.nutanix.com\/foundation_central\/releases\/1.6\/lcm_foundation-central_1.6.tar.gz"},{"type":"LOCAL","name":"FOUNDATION","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"value":"http:\/\/download.nutanix.com\/Foundation\/5.6.1\/lcm_foundation_5.6.1.tar.gz"},{"type":"LOCAL","name":"LCM_COMPATIBILITY_SIGNATURE","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"value":"https:\/\/download.nutanix.com\/product-meta\/lcm\/nutanix_compatibility_bundle.tar.gz"},{"type":"LOCAL","name":"LCM_FRAMEWORK_BUNDLE","description":"","options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"editables":{"value":true},"value":"http:\/\/download.nutanix.com\/lcm\/3.0.1-H\/lcm_dark_site_bundle_3.0.1.51640-H.tar.gz"}],"action_list":[{"type":"user","name":"Reconfigure LCM","description":"","runbook":{"name":"89b202ec_runbook","description":"","task_definition_list":[{"type":"DAG","name":"66ae7ab8_dag","description":"","attrs":{"type":"","edges":[{"type":"","from_task_reference":{"name":"Install NGINX","kind":"app_task"},"to_task_reference":{"name":"Configure NGINX","kind":"app_task"},"edge_type":"user_defined"},{"type":"","from_task_reference":{"name":"Configure LCM Web Server","kind":"app_task"},"to_task_reference":{"name":"Download LCM Updates","kind":"app_task"},"edge_type":"user_defined"},{"type":"","from_task_reference":{"name":"Download LCM Updates","kind":"app_task"},"to_task_reference":{"name":"Get LCM eTag","kind":"app_task"},"edge_type":"user_defined"},{"type":"","from_task_reference":{"name":"Get LCM eTag","kind":"app_task"},"to_task_reference":{"name":"Reconfigure LCM for Dark Site Web Server","kind":"app_task"},"edge_type":"user_defined"},{"type":"","from_task_reference":{"name":"Configure NGINX","kind":"app_task"},"to_task_reference":{"name":"Configure Firewall","kind":"app_task"},"edge_type":"user_defined"},{"type":"","from_task_reference":{"name":"Configure Firewall","kind":"app_task"},"to_task_reference":{"name":"Configure LCM Web Server","kind":"app_task"},"edge_type":"user_defined"}]},"child_tasks_local_reference_list":[{"name":"Install NGINX","kind":"app_task"},{"name":"Configure NGINX","kind":"app_task"},{"name":"Configure Firewall","kind":"app_task"},{"name":"Configure LCM Web Server","kind":"app_task"},{"name":"Download LCM Updates","kind":"app_task"},{"name":"Get LCM eTag","kind":"app_task"},{"name":"Reconfigure LCM for Dark Site Web Server","kind":"app_task"}],"variable_list":[],"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"EXEC","name":"Install NGINX","description":"","attrs":{"type":"","script":"#!\/bin\/sh\n\n# install, start and enable nginx\nsudo dnf -y install epel-release\nsudo dnf -y install nginx\nsudo systemctl start nginx\nsudo systemctl enable nginx","script_type":"sh","command_line_args":"","exit_status":[],"login_credential_local_reference":{"name":"admin","kind":"app_credential"}},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"BasicLinux","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"EXEC","name":"Configure NGINX","description":"","attrs":{"type":"","script":"# configure some best-practice nginx settings\n\n#################################################\n#                                               #\n# THESE ARE GENERAL SETTINGS ONLY AND WILL NEED #\n# NEED TO BE CAREFULLY CHECKED BEFORE USE IN A  #\n# PRODUCTION ENVIRONMENT!                       #\n#                                               #\n# SERIOUSLY, CHECK THEM!  :)                    #\n#                                               #\n#################################################\n\n# set the number of nginx worker processes to be the same as the number of cores in this system\nPROCS=`sudo grep processor \/proc\/cpuinfo | wc -l`\nsudo sed -i -- \"s\/worker_processes.*\/worker_processes $PROCS;\/\" \/etc\/nginx\/nginx.conf\n\n# set the number of worker connections to the max allowed by nginx\n# this allows the server to operate at max potential, if required\nsudo sed -i -- 's\/worker_connections.*\/worker_connections 1024;\/' \/etc\/nginx\/nginx.conf\n\n# enable gzip compression\necho \"gzip on;\ngzip_proxied any;\ngzip_types text\/plain text\/xml text\/css application\/x-javascript;\ngzip_vary on;\ngzip_disable \\\"MSIE [1-6]\\.(?!.*SV1)\\\";\" | sudo tee \/etc\/nginx\/conf.d\/gzip.conf\n\n# setup cache expiry for static files\necho \"location ~*  \\.(jpg|jpeg|png|gif|ico|css|js)\\$ {\n   expires @@{STATIC_EXPIRATION_DAYS}@@d;\n}\" | sudo tee \/etc\/nginx\/default.d\/expires.conf\n\n# set the client buffers\n# this is critical on busy systems\necho \"client_body_buffer_size  1K;\nclient_header_buffer_size 1k;\nclient_max_body_size 1k;\nlarge_client_header_buffers 2 1k;\" | sudo tee \/etc\/nginx\/conf.d\/buffer.conf\n\n# set the client timeouts - performance improvement under certain circumstances\necho \"client_body_timeout 12;\nclient_header_timeout 12;\nsend_timeout 10;\" | sudo tee \/etc\/nginx\/conf.d\/timeout.conf\n\n# set the keepalive timeout separately\n# done this way because the above settings are not in nginx.conf by default, but keepalive_timeout is\n# this means we can modify it, rather than setting a new value\nsudo sed -i -- 's\/keepalive_timeout.*\/keepalive_timeout 15;\/' \/etc\/nginx\/nginx.conf\n\n# configure site root\nsudo mkdir -p \/mnt\/lcm\/web\nsudo sed -i -- 's\/\\\/usr\\\/share\\\/nginx\\\/html\/\\\/mnt\\\/lcm\\\/web\/g' \/etc\/nginx\/nginx.conf\n\n# customise NGINX: log all NGINX access requests\nsudo sed -i -- 's\/access_log.*off;\/access_log \\\/var\\\/log\\\/nginx\\\/access.log;\/g' \/etc\/nginx\/nginx.conf\n# customise NGINX: enable directory listing (LCM requirement)\nsudo sed -i -- '\/root.*;\/a \\\\tautoindex on;' \/etc\/nginx\/nginx.conf\n\n\n# configure selinux to allow Nginx in Permissive mode\nsudo semanage permissive -a httpd_t","script_type":"sh","command_line_args":"","exit_status":[],"login_credential_local_reference":{"name":"admin","kind":"app_credential"}},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"BasicLinux","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"EXEC","name":"Configure Firewall","description":"","attrs":{"type":"","script":"#!\/bin\/sh\n\n# configure the firewall to allow HTTP requests (port 80, by default)\nsudo systemctl start firewalld\nsudo systemctl enable firewalld\nsudo firewall-cmd --permanent --add-service=http\nsudo firewall-cmd --reload","script_type":"sh","command_line_args":"","exit_status":[],"login_credential_local_reference":{"name":"admin","kind":"app_credential"}},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"BasicLinux","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"EXEC","name":"Configure LCM Web Server","description":"","attrs":{"type":"","script":"#!\/bin\/sh\n\n# create LCM release directory\nsudo mkdir -p -m 755 \/mnt\/lcm\/web\/release\n\n# create temporary LCM download location\nsudo mkdir -p -m 755 \/mnt\/lcm\/download\n\n# restart NGINX to make sure all previous changes are loaded\nsudo systemctl restart nginx","script_type":"sh","command_line_args":"","exit_status":[],"login_credential_local_reference":{"name":"admin","kind":"app_credential"}},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"BasicLinux","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"EXEC","name":"Download LCM Updates","description":"","attrs":{"type":"","script":"#!\/bin\/sh\n\n# download LCM support files as per short-term download links\ncd \/mnt\/lcm\/download\n\n# download LCM framework\/dark site bundle\nsudo curl -L -O \"@@{LCM_FRAMEWORK_BUNDLE}@@\"\n\n# pre-seed the LCM update files\n# this is for demo only!\n\nfor i in \"@@{LCM_COMPATIBILITY_SIGNATURE}@@\" \"@@{FOUNDATION}@@\" \"@@{FOUNDATION_CENTRAL}@@\" \"@@{FIRMWARE}@@\" \"@@{FILE_SERVER}@@\" \"@@{FSM}@@\" \"@@{FILES_MANAGER}@@\" \"@@{FILES_ANALYTICS}@@\" \"@@{OBJECTS}@@\" \"@@{FLOW_PC}@@\" \"@@{FLOW_PE}@@\" \"@@{FLOW_VIRTUAL_NETWORKING}@@\" \"@@{NKE}@@\" \"@@{AOS}@@\" \"@@{AHV}@@\" \"@@{PC}@@\" \"@@{CMU}@@\" \"@@{NCC}@@\" \"@@{SELF_SERVICE_EPSILON}@@\" \"@@{SELF_SERVICE_NUCALM}@@\" \"@@{MSP}@@\"\ndo\nsudo curl -L -O $i\ndone\n\n# extract LCM dark site bundles into place\nfor i in .\/*.tar.gz\ndo\nsudo tar xzvf $i --directory \/mnt\/lcm\/web\/release\ndone\n\n# extract Self Service dark site bundles into place\nfor i in .\/*.zip\ndo\nsudo unzip $i -d \/mnt\/lcm\/web\/release\ndone\n\n# comment the next 2 lines to NOT remove downloaded LCM files\nsudo rm *.tar.gz\nsudo rm *.zip","script_type":"sh","command_line_args":"","exit_status":[],"login_credential_local_reference":{"name":"admin","kind":"app_credential"}},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"BasicLinux","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"HTTP","name":"Get LCM eTag","description":"","attrs":{"type":"","method":"GET","connection_timeout":120,"headers":[],"url":"https:\/\/localhost:9440\/api\/lcm\/v4.0.a1\/resources\/config","request_body":"","content_type":"application\/json","expected_response_params":[{"type":"","code":200,"status":"SUCCESS"}],"authentication":{"type":"basic_with_cred","credential_local_reference":{"name":"Prism Central Admin","kind":"app_credential"}},"response_paths":{"current_etag":"$.metadata.ETag"},"tls_verify":false,"proxy_type":"","retry_count":1,"retry_interval":1},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"BasicLinux","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false},{"type":"HTTP","name":"Reconfigure LCM for Dark Site Web Server","description":"","attrs":{"type":"","method":"PUT","connection_timeout":120,"headers":[{"type":"LOCAL","name":"If-Match","description":"","regex":{"value":"","should_validate":true},"options":{"type":"PREDEFINED","choices":[]},"is_hidden":false,"is_mandatory":false,"data_type":"BASE","val_type":"STRING","label":"","attrs":{"type":""},"state":"NOT_VALIDATED","message_list":[],"editables":{},"value":"@@{current_etag}@@"}],"url":"https:\/\/localhost:9440\/api\/lcm\/v4.0.a1\/resources\/config","request_body":"{\n  \"isDarksite\": true,\n  \"enableHttps\": false,\n  \"url\": \"http:\/\/@@{address}@@\/release\"\n}","content_type":"application\/json","expected_response_params":[{"type":"","code":200,"status":"SUCCESS"}],"authentication":{"type":"basic_with_cred","credential_local_reference":{"name":"Prism Central Admin","kind":"app_credential"}},"response_paths":{},"tls_verify":false,"proxy_type":"","retry_count":1,"retry_interval":1},"child_tasks_local_reference_list":[],"variable_list":[],"target_any_local_reference":{"name":"BasicLinux","kind":"app_service"},"timeout_secs":"0","retries":"0","inherit_target":false}],"main_task_local_reference":{"name":"66ae7ab8_dag","kind":"app_task"},"variable_list":[]},"critical":false}],"deployment_create_list":[{"type":"GREENFIELD","name":"basiclinuxvm_deployment","description":"","variable_list":[],"action_list":[],"depends_on_list":[],"min_replicas":"1","max_replicas":"1","default_replicas":"1","package_local_reference_list":[{"name":"BasicLinuxPackage","kind":"app_package"}],"substrate_local_reference":{"name":"BasicLinuxVm","kind":"app_substrate"},"options":{"type":""},"published_service_local_reference_list":[]}],"snapshot_config_list":[],"restore_config_list":[],"environment_reference_list":[],"application_url":"","patch_list":[]}],"credential_definition_list":[{"type":"PASSWORD","name":"admin","description":"","username":"admin","secret":{"attrs":{"secret_reference":{},"is_secret_modified":false}},"cred_class":"static"},{"type":"PASSWORD","name":"Prism Central Admin","description":"","username":"admin","secret":{"attrs":{"secret_reference":{},"is_secret_modified":false}},"cred_class":"static"}],"default_credential_local_reference":{"name":"admin","kind":"app_credential"},"type":"USER","client_attrs":{"null":{"Profile":{"Default":{"Action":{},"dsl_name":"Default"}},"Package":{"CentosImage":{"Action":{},"dsl_name":"CentosImage"},"BasicLinuxPackage":{"Action":{},"dsl_name":"BasicLinuxPackage"}},"Substrate":{"BasicLinuxVm":{"Action":{},"AhvVm":{"vm-@@{calm_array_index}@@-@@{calm_time}@@":{"dsl_name":"vmcalm_array_indexcalm_time"}},"dsl_name":"BasicLinuxVm"}},"Service":{"BasicLinux":{"Action":{},"dsl_name":"BasicLinux"}},"Deployment":{"basiclinuxvm_deployment":{"Action":{},"dsl_name":"basiclinuxvm_deployment"}}},"basiclinuxvm_deployment":{"y":-580,"x":-239}}}},"api_version":"3.0","product_version":"3.8.0","metadata":{"last_update_time":"1724008378967240","creation_time":"1717550579092697","spec_version":65,"name":"create_lcm_darksite_web_server","kind":"blueprint"},"contains_secrets":false}